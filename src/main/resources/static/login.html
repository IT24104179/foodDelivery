<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ByteEats - Login</title>
</head>
<body>
<h2>User Login</h2>

<form id="loginForm">
    <input type="email" placeholder="Email" id="email" required><br>
    <input type="password" placeholder="Password" id="password" required><br>
    <button type="submit">Login</button>
</form>

<p id="loginMsg"></p>

<script>
    const params = new URLSearchParams(location.search);
const pageRole = params.get("role") || "customer";       // owner | customer

/********** existing listener **********/
document.getElementById('loginForm').addEventListener('submit', async e=>{
  e.preventDefault();

  const loginData = {
     email   : email.value,
     password: password.value
  };
  const res = await fetch("/api/users/login", {
       method : "POST",
       headers: {"Content-Type":"application/json"},
       body   : JSON.stringify(loginData)
  });
  const txt = await res.text();
  loginMsg.textContent = txt;

  /* success? our earlier controller returns
     "Login success: {username} (customer)"           */
  if (txt.startsWith("Login success")){
        const userRole = txt.includes("(restaurant)") ? "restaurant":"customer";
        if (pageRole==="owner" && userRole!=="restaurant"){
            alert("Only owner can log in here");
            return;
        }
        localStorage.setItem("username", txt.split(":")[1].split("(")[0].trim());
        localStorage.setItem("role", userRole);
        location.href = "home.html";
  }
});

    const form = document.getElementById('loginForm');
    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        const loginData = {
            email: document.getElementById('email').value,
            password: document.getElementById('password').value
        };

        const res = await fetch("/api/users/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(loginData)
        });

        const msg = await res.text();
        document.getElementById('loginMsg').innerText = msg;
    });
</script>
</body>
</html>
